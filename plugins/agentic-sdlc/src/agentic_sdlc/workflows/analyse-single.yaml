name: analyse-single
version: "1.0"
description: Run a single type of codebase analysis with optional autofix

settings:
  max-retry: 2
  timeout-minutes: 60
  track-progress: true
  terminal-output: base

variables:
  - name: analysis_type
    type: string
    required: true
    description: Type of analysis to run (bug, debt, doc, security, style)
  - name: autofix
    type: string
    required: false
    default: "none"
    description: Severity level for automatic fixes (none, minor, major, critical)

steps:
  - name: run-analysis
    type: command
    command: analyse
    args:
      type: "{{ variables.analysis_type }}"

  - name: check-autofix
    type: conditional
    condition: "variables.autofix != 'none'"
    then:
      - name: fix-issues
        type: prompt
        prompt: |
          Review the {{ variables.analysis_type }} analysis in agentic/analysis/{{ variables.analysis_type }}.md.
          Fix all issues with severity {{ variables.autofix }} or higher.
          Commit fixes with clear messages.

outputs:
  - name: analysis-report
    template: analysis/{{ variables.analysis_type }}.md.j2
    path: {{ variables.analysis_type }}.md
    when: completed
