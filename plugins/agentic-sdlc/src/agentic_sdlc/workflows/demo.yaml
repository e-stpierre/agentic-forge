name: demo
version: "1.0"
description: Demo workflow to validate agentic-sdlc plugin installation and configuration

settings:
  track-progress: true
  terminal-output: all
  bypass-permissions: false
  required-tools:
    - Write
    - Read
    - Bash
  git:
    enabled: false
    worktree: false

steps:
  - name: welcome
    type: prompt
    model: haiku
    prompt: |
      # Welcome to the agentic-sdlc Demo Workflow

      This is a demonstration workflow that validates your agentic-sdlc plugin installation.

      Please acknowledge this welcome message by saying: "Demo workflow started successfully."

  - name: create-demo-files
    type: parallel
    merge-strategy: wait-all
    merge-mode: independent
    git:
      worktree: false
    steps:
      - name: create-demo-1
        type: prompt
        model: haiku
        prompt: |
          Create a file named `demo-1.md` at the repository root.

          The file should contain:
          ```markdown
          # Demo File 1

          Created by: agentic-sdlc demo
          Timestamp: [current timestamp]
          Step: create-demo-1

          This file was created to validate the workflow execution.
          ```

          Use the Write tool to create this file.

          IMPORTANT: If you encounter a permission error when trying to write this file,
          you MUST stop immediately and report: "PERMISSION ERROR: Unable to write demo-1.md"
          Do not attempt any workarounds.

      - name: create-demo-2
        type: prompt
        model: haiku
        prompt: |
          Create a file named `demo-2.md` at the repository root.

          The file should contain:
          ```markdown
          # Demo File 2

          Created by: agentic-sdlc demo
          Timestamp: [current timestamp]
          Step: create-demo-2

          This file was created to validate the workflow execution.
          ```

          Use the Write tool to create this file.

          IMPORTANT: If you encounter a permission error when trying to write this file,
          you MUST stop immediately and report: "PERMISSION ERROR: Unable to write demo-2.md"
          Do not attempt any workarounds.

  - name: random-facts-loop
    type: ralph-loop
    model: haiku
    max-iterations: 5
    completion-promise: THREE_FACTS_WRITTEN
    prompt: |
      ## Random Facts Loop - Iteration {{iteration}}/{{max_iterations}}

      You are in a Ralph Wiggum iterative loop adding random knowledge facts to demo-1.md.

      ## Your Task
      1. Read the file `demo-1.md` at the repository root
      2. Add ONE new numbered random knowledge fact to the "Random Facts" section
      3. If the "Random Facts" section does not exist, create it at the end of the file
      4. Save the file and STOP (exit the session)

      ## Random Facts Section Format
      ```markdown
      ## Random Facts

      1. [Your first random fact here]
      2. [Your second random fact here]
      ...
      ```

      ## Exit Instructions
      - After adding ONE fact, you MUST exit the session immediately
      - Do NOT add multiple facts in a single iteration
      - Simply stop working after saving the file - the loop will automatically continue

      ## Completion Condition
      When the file contains EXACTLY 3 numbered facts in the Random Facts section, output:
      ```json
      {"ralph_complete": true, "promise": "THREE_FACTS_WRITTEN"}
      ```

      **IMPORTANT**:
      - Count the existing facts BEFORE adding a new one
      - If there are already 2 facts, add the 3rd fact and THEN output the completion JSON
      - If there are already 3 or more facts, output the completion JSON immediately without adding more
      - If there are 0-1 facts, add ONE fact and then STOP (do not output completion JSON yet)

  - name: git-branch
    type: prompt
    prompt: /git-branch --name demo/random-facts

  - name: git-commit
    type: prompt
    prompt: /git-commit --message "demo: add demo files with random facts"

  - name: completion
    type: prompt
    model: haiku
    prompt: |
      # Demo Workflow Complete

      The agentic-sdlc demo workflow has finished executing.

      ## Validation Tasks

      You MUST verify ALL of the following before reporting completion:

      ### 1. File Validation
      - Read `demo-1.md` and verify it exists at the repository root
      - Read `demo-2.md` and verify it exists at the repository root

      ### 2. Random Facts Validation
      - Verify that `demo-1.md` contains a "Random Facts" section with EXACTLY 3 numbered facts
      - Count the facts to confirm there are 3

      ### 3. Git Branch Validation
      - Run `git branch --show-current` to check the current branch
      - Verify the current branch is `demo/random-facts`

      ### 4. Git Commit Validation
      - Run `git log -1 --oneline` to check the most recent commit
      - Verify a commit exists with a message containing "demo" or "random facts"

      ## Reporting

      After performing ALL validations, report the results:

      If ALL validations passed, say:
      "DEMO WORKFLOW COMPLETED SUCCESSFULLY - Your agentic-sdlc installation is working correctly!

      Validation Summary:
      - demo-1.md: Created with 3 random facts
      - demo-2.md: Created
      - Git branch: demo/random-facts
      - Git commit: [commit message]"

      If ANY validation failed, report which ones and end with:
      "DEMO WORKFLOW COMPLETED WITH ISSUES - Please review the errors above."

      Remind the user to clean up by running:
      - `git checkout main`
      - `git branch -D demo/random-facts`
      - Delete demo-1.md and demo-2.md
