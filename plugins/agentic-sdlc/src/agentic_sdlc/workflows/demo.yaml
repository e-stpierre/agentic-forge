name: demo
version: "1.0"
description: Demo workflow to validate agentic-sdlc plugin installation and configuration

settings:
  track-progress: true
  terminal-output: all
  bypass-permissions: false
  required-tools:
    - Write
    - Read
    - Bash
  git:
    enabled: false
    worktree: false

steps:
  - name: welcome
    type: prompt
    model: haiku
    prompt: |
      # Welcome to the agentic-sdlc Demo Workflow

      This is a demonstration workflow that validates your agentic-sdlc plugin installation.

      Please acknowledge this welcome message by saying: "Demo workflow started successfully."

  - name: create-demo-files
    type: parallel
    merge-strategy: wait-all
    merge-mode: independent
    git:
      worktree: false
    steps:
      - name: create-demo-1
        type: prompt
        model: haiku
        prompt: |
          Create a file named `demo-1.md` at the repository root.

          The file should contain:
          ```markdown
          # Demo File 1

          Created by: agentic-sdlc demo
          Timestamp: [current timestamp]
          Step: create-demo-1

          This file was created to validate the workflow execution.
          ```

          Use the Write tool to create this file.

          IMPORTANT: If you encounter a permission error when trying to write this file,
          you MUST stop immediately and report: "PERMISSION ERROR: Unable to write demo-1.md"
          Do not attempt any workarounds.

      - name: create-demo-2
        type: prompt
        model: haiku
        prompt: |
          Create a file named `demo-2.md` at the repository root.

          The file should contain:
          ```markdown
          # Demo File 2

          Created by: agentic-sdlc demo
          Timestamp: [current timestamp]
          Step: create-demo-2

          This file was created to validate the workflow execution.
          ```

          Use the Write tool to create this file.

          IMPORTANT: If you encounter a permission error when trying to write this file,
          you MUST stop immediately and report: "PERMISSION ERROR: Unable to write demo-2.md"
          Do not attempt any workarounds.

  - name: random-facts-loop
    type: ralph-loop
    model: haiku
    max-iterations: 5
    completion-promise: THREE_FACTS_WRITTEN
    prompt: |
      ## Random Facts Loop - Iteration {{iteration}}/{{max_iterations}}

      You are in a Ralph Wiggum iterative loop adding random knowledge facts to demo-1.md.

      ## Your Task
      1. Read the file `demo-1.md` at the repository root
      2. Add ONE new numbered random knowledge fact to the "Random Facts" section
      3. If the "Random Facts" section does not exist, create it at the end of the file
      4. Save the file and STOP (exit the session)

      ## Random Facts Section Format
      ```markdown
      ## Random Facts

      1. [Your first random fact here]
      2. [Your second random fact here]
      ...
      ```

      ## Exit Instructions
      - After adding ONE fact, you MUST exit the session immediately
      - Do NOT add multiple facts in a single iteration
      - Simply stop working after saving the file - the loop will automatically continue

      ## Completion Condition
      When the file contains EXACTLY 3 numbered facts in the Random Facts section, output:
      ```json
      {"ralph_complete": true, "promise": "THREE_FACTS_WRITTEN"}
      ```

      **IMPORTANT**:
      - Count the existing facts BEFORE adding a new one
      - If there are already 2 facts, add the 3rd fact and THEN output the completion JSON
      - If there are already 3 or more facts, output the completion JSON immediately without adding more
      - If there are 0-1 facts, add ONE fact and then STOP (do not output completion JSON yet)

  - name: git-branch
    type: command
    command: git-branch
    args:
      name: demo/random-facts

  - name: git-commit
    type: command
    command: git-commit
    args:
      message: "demo: add demo files with random facts"

  - name: completion
    type: prompt
    model: haiku
    prompt: |
      # Demo Workflow Complete

      The agentic-sdlc demo workflow has finished executing.

      Please verify the following:
      1. Two files were created: demo-1.md and demo-2.md at the repository root
      2. No permission errors occurred during execution

      If everything succeeded, say:
      "DEMO WORKFLOW COMPLETED SUCCESSFULLY - Your agentic-sdlc installation is working correctly!"

      Remind the user to delete demo-1.md and demo-2.md after reviewing them.

      IMPORTANT: If any permission issues occurred during this workflow, report them now
      and end with: "DEMO WORKFLOW COMPLETED WITH ISSUES - Please review the errors above."
