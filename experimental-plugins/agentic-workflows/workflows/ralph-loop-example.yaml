name: ralph-loop-example
version: "1.0"
description: Example workflow demonstrating the Ralph Wiggum iterative loop pattern

settings:
  max-retry: 3
  timeout-minutes: 120
  track-progress: true
  git:
    enabled: true
    auto-commit: true
    auto-pr: false

variables:
  - name: task
    type: string
    required: true
    description: Task to complete iteratively
  - name: max_iterations
    type: number
    required: false
    default: 5
    description: Maximum iterations before stopping

steps:
  - name: iterative-task
    type: ralph-loop
    prompt: |
      ## Task
      {{ variables.task }}

      ## Instructions
      1. Analyze the current state of the codebase
      2. Identify what needs to be done next
      3. Make incremental progress on the task
      4. Commit your changes with a clear message
      5. Assess if the task is fully complete

      ## Completion
      When the task is FULLY complete and verified, output:
      ```json
      {"ralph_complete": true, "promise": "TASK_COMPLETE"}
      ```

      IMPORTANT: Only output the completion JSON when everything is genuinely done.
      Do not output false promises to exit early.
    max-iterations: "{{ variables.max_iterations }}"
    completion-promise: "TASK_COMPLETE"
    model: sonnet
    timeout-minutes: 30

outputs:
  - name: ralph-report
    template: ralph-report.md.j2
    path: agentic/workflows/{{ workflow_id }}/ralph-report.md
    when: completed
